---
title: "Uncertainty in times of COVID-19: Raw survey data"
author: "Fabian Lange, Lars Vilhuber"
date: "`r Sys.Date()`"
output:
  html_document: 
    keep_md: yes
    self_contained: no
    toc: yes
    toc_float: yes
    df_print: paged
    lib_dir: libs
  pdf_document:
    toc: yes
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(cache = TRUE)
```
```{r config_libs,include=FALSE,message=FALSE,cache=FALSE}
source(file.path(rprojroot::find_root(rprojroot::has_file("pathconfig.R")),"pathconfig.R"),echo=TRUE)
source(file.path(programs,"global-libraries.R"),echo=TRUE)
source(file.path(programs,"config.R"),echo=TRUE)

test.question.date <- "20200412"
prelim.question.date <- "20200421" # date we downloaded the final results from the test.

planned.n = 250 


# file names (no path)
gcsresults <- "gcs_results"
gcsprelim.results <- paste0(gcsresults,test.question.date)
gcsprelim.list <- "gcs_prelim_list"
gcsprelim.final.results <- paste0(gcsresults,prelim.question.date)
gcsprelim.final.list <- "gcs_prelim_final_list"

```


# Expectations about Continuation of Social Distancing Rules in COVID-19 Times

Data from a survey of consumer expectations

## Description

From April 24, 2020, Fabian Lange and Lars Vilhuber will conduct the survey "Uncertainty in COVID-19 times". The survey is a single-question survey focusing on people's anticipation about social distancing rules and firm closures during the 2020 COVID-19 health crisis. 

We believe that this information is not otherwise available in a reliable and timely fashion. The information should be usable by policy-makers and researchers, to be included in models of future developments of society and the economy.

### Citation

Please cite the data as 

> Lange, Fabian and Lars Vilhuber. 2020. "Expectations about Continuation of Social Distancing Rules in COVID-19 Times [dataset]." (this URL)

We will be posting the data on Zenodo shortly. Data should be cite via DOI then.

### Reference period

The survey asks about point-in-time expectations. A new wave is launched every Friday. The list below provides the dates of collection for each wave.

(LIST TO BE DERIVED FROM DATA)

## Data description

|  Topic | Answer |
|--------|--------|
| Geographic Coverage | United States of America, Canada |
| Time  Periods | 2020-04-24 - TO BE FILLED |
| Date of Collection | 2020-04-24 - TO BE FILLED |
| Unit of Observation | Individual |
| Description of Variables | Response to question, gender, age, geography, weight |

### Data Dictionary

#### Q1: Answer to primary question

This field will differ across the two types of files.

(TO BE FILLED OUT)

#### Age

(TO BD FILLED OUT)

#### Gender

(TO BE FILLED OUT)

#### Geography

Geography is as coded by Google Surveys. Precision may vary.

(TO BE FILLED OUT)

#### Weight

(TO BE FILLED OUT)

### Data structure

Data files are available for each completed cycle of the survey, in general once a week, and are stored under [`final`](final/). Data from the preliminary study (assessing the questionnaire design) is stored under [`preliminary`](preliminary/). We may make available data before the survey is completed for each cycle, under [`temporary`](temporary/), however, once the final version from that cycle is available, these are deleted (this directory will be empty on Zenodo).


### Data format

Native format is Excel (XLSX). Filenames in [`final`](final/) are tagged with geography, language, the question type,and date downloaded:

> `survey-[geography]-[language]-[question]-[date].xlsx`

[`Temporary`](temporary/) files follow

> `survey-[surveyid].xlsx`

Files are provided as downloaded from Google Surveys. Each file has 4 tabs.

#### Overview

Lists the questions asked by the client, in this case Lange and Vilhuber, as well as a survey ID.

#### Topline

This tab contains a weighted summary of the responses to the questions (similar to the above summary). 

#### Complete responses

This tab contains the actual microdata for any complete responses. Note that for a single-question survey, this is identical to the "All responses". A complete response might have a weight of zero.

#### All responses

All responses, whether complete or not, are recorded on this tab. In the case of a single-question survey, this is identical to the "Complete responses" tab.

## Data sources and methodology

### Target population

- All Canadians aged 18 and older from the ten provinces and three territories are eligible to participate.
- All US residents aged 18 and older are eligible to participate.

### Instrument design

Each individual is asked one of two questions: how long they expect "social distancing rules" or "business closures" to remain in effect:

- How much longer do you expect social distancing rules (restrictions on gatherings, stay-at-home rules) to stay in place in your province/state?
- How much longer do you expect the closure of non-essential businesses to stay in place in your province/state?

Five response choices are offered: 

- "less than 1 month", 
- "1-2 months", 
- "2-3 months", 
- "3-6 months", 
- "more than 6 months". 

An additional answer allows respondents to affirm that "such measures are not implemented in their province/state". See [questionnaires.md] for visual representation of the questions. 


<img src="questionnaires/Screenshot_Survey1_consumer.png" width="200px" />
<img src="questionnaires/Screenshot_Survey2_closures.png" width="200px" />

### Data collection

Data is collected via Google Surveys. For English-language surveys, data is collected via a web form. For French-language surveys, the Android Google Survey app is used, as web-collection in French is not possible via Google Surveys. See Google (2018) for more details.

### Sampling

Google Surveys is an online non-probability survey. It uses  stratified sampling for collection, based (in the US) on the target internet population from the  2017 Current Population Survey (CPS) Computer and Internet Use Supplement [@sostek_how_2018;@google_methodology_2020]. 

Data are collected directly from survey respondents.

For each country, we plan to collect 2500 responses per question, per week. For Canada, a French-language variant is fielded. For 2016, 20.4% of Canadians spoke French and no English as the language spoken most often at home. We thus target 510 responses via the French-language questionnaire, and 1990 in English.

### Imputation

All demographics are imputed by Google Surveys, if collected via web. Demographics for respondents via the app are collected through the app. 

### Quality evaluation

A preliminary survey was conducted to allow for choice of either a two-question variant, or a one-question variant that incluced both social distancing and business closures ("How much longer do you expect social distancing rules (restrictions on gatherings, closure of non-essential businesses, stay-at-home rules) to stay in place in your province?"). See [evaluation.md] for more information. 



### Privacy and disclosure control

Privacy and disclosure control are described in Google (2018). For most respondents, no direct or indirect identifiers are collected, and are imputed based on other information available to Google, but not the sponsors of the survey. 

### Response rates

The specific response rates are not known. Google (2018) reports response rates in general for this type of data collection.




```{r read_list,include=FALSE,cache=FALSE}
# Compile all the worksheets 
gcsdir_prelim <- file.path(gcsdir,"preliminary")
ws <- 
  enframe(list.files(gcsdir_prelim,"*.xlsx")) %>% 
  mutate(filename=value,path=gcsdir_prelim) %>%
  separate(value,c("drop","tag","date","time"),sep="-") %>%
  separate(time,c("time"),extra = "drop") %>% 
  filter(date==prelim.question.date) %>%
  select(-drop,-name)

for ( x in 1:nrow(ws) ) {
  filename=as.character(ws[x,"filename"])
  path=as.character(ws[x,"path"])
  if ( file.exists(file.path(path,filename )) ) {
    print(paste("Processing: ", filename))
    if ( x == 1 ) {
      # Read in the first list and set variable types
      results <- read_excel(file.path(path,filename),
                            sheet = "Complete responses")
      results$tag <- as.character(ws[x,"tag"])
      results$date <- as.character(ws[x,"date"])
    } else {
      # Read in the subsequent lists and set variable types
      tmp <- read_excel(file.path(path,filename),
                            sheet = "Complete responses")
      tmp$tag <- as.character(ws[x,"tag"])
      tmp$date <- as.character(ws[x,"date"])
      # Add to master dataframe
      results <- bind_rows(results,tmp)
      rm(tmp)
    }
  }
}
# clean up a bit
results %>% 
  rename(Q1 = `Question #1 Answer`) %>%
  rename(rt_Q1_ms = `Response Time #1 (ms)` ) %>%
  mutate(Q1 = factor(Q1,levels=c("less than 1 month","1-2 months","2-3 months","3-6 months","more than 6 months","My province has not implemented such rules."))) -> results.final
#mysave(results.final,gcsresults)

if (file.exists(file.path(outputs,paste0(gcsprelim.final.results,".Rds")))) {
  print("Not overwriting existing file.")
} else {
  results.final %>% filter(tag==prelim.question.date) -> results.prelim
  mysave(results.prelim,gcsprelim.final.results)
  mysave(ws,gcsprelim.final.list)
}
# end of else

# get metadata 
results.final %>% summarize(begintime=min(`Time (UTC)`),endtime=max(`Time (UTC)`)) %>%
  mutate(begindate=as.Date(begintime),enddate=as.Date(endtime)) -> dates.final
dates.final.begin <- pull(dates.final,begindate)
dates.final.end <- pull(dates.final,enddate)
```

## Sources

We pre-registered the decision based on preliminary data collected after the first day of fielding the question (on `r test.question.date`). The decision about choice of the question, as well as preliminary descriptive results, are  based on data collected over the entire test time period, with a target n of `r planned.n` per question. We collected data from `r dates.final.begin` to `r dates.final.end` across Canada, achieving a total n=`r nrow(results.final)`.

The data was manually downloaded from the Google Consumer Survey site on `r prelim.question.date`, and saved, using the  naming convention `tag-YYYYMMDD-HHMM.xlsx`. Data are available in our Github repository.

## Fielded questions

We fielded three questions in the test sample:

- How much longer do you expect social distancing rules (restrictions on gatherings, stay-at-home rules) to stay in place in your province?
- How much longer do you expect the closure of non-essential businesses to stay in place in your province?
- How much longer do you expect social distancing rules (restrictions on gatherings, closure of non-essential businesses, stay-at-home rules) to stay in place in your province?

For each question, we collected responses on a Likert scale with text: "less than 1 month", "1-2 months", "2-3 months", "3-6 months", "more than 6 months", and a response equivalent to "does not apply" ("My province has not implemented such rules.").

<img src="../assets/Screenshot_Survey1_consumer.png" width="200px" />
<img src="../assets/Screenshot_Survey2_closures.png" width="200px" />
<img src="../assets/Screenshot_Survey3_composite.png" width="200px" />

## First results

Total observation by tag / question:

```{r summarize}
results.final %>% group_by(tag,date) %>%
  summarise(count=n()) %>%
  kable()
```

Distribution of responses:

```{r details, results="asis"}
results.final %>% group_by(tag,Q1) %>%
  summarise(count=n()) %>% 
  group_by(tag) %>%
  mutate(percent = count / sum(count)) -> tmp
tags <- c("business","composite","people")
print.part <- function(tagselect) {
  tmp %>% filter(tag==tagselect) %>% 
    mutate(percent = round(percent*100,2)) %>%
  kable() %>%
  return()
}
lapply(as.list(tags), print.part)
#htmltools::tagList(lapply(as.list(tags), print.part))
```


